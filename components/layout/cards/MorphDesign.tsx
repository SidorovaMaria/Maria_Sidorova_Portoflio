"use client";
import React, { useRef } from "react";
import gsap from "gsap";
import { useGSAP } from "@gsap/react";
import { MorphSVGPlugin } from "gsap/MorphSVGPlugin";
gsap.registerPlugin(MorphSVGPlugin);

export default function MorphDesign() {
  const root = useRef<SVGSVGElement | null>(null);
  MorphSVGPlugin.defaultType = "rotational";
  useGSAP(
    () => {
      gsap.set(["#discuss", "#prototype", "#product"], { opacity: 0 });

      gsap
        .timeline({ repeat: -1, yoyo: true, repeatDelay: 1, delay: 1 })
        .to(
          "#code",
          {
            duration: 1.5,
            ease: "sine.inOut",
            morphSVG: { shape: "#discuss", shapeIndex: "auto", type: "rotational" },
          },
          ">1"
        )
        .to(
          "#code",
          {
            duration: 1.5,
            ease: "sine.inOut",
            morphSVG: { shape: "#prototype", shapeIndex: "auto", type: "rotational" },
          },
          ">1"
        )
        .to(
          "#code",
          {
            duration: 1.5,
            ease: "sine.inOut",
            morphSVG: { shape: "#product", shapeIndex: "auto", type: "rotational" },
          },
          ">1"
        );
    },
    { scope: root }
  );
  return (
    <div className="flex flex-col items-start gap-4">
      <svg
        ref={root}
        width="300"
        height="300"
        viewBox="0 0 300 300"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        style={{ display: "block" }}
      >
        {/* Active path we morph (starts as Code) */}
        <path
          id="code" /* ACTIVE path */
          d="M37.5 52.5H262.5C283.211 52.5 300 69.2893 300 90V210C300 230.711 283.211 247.5 262.5 247.5H37.5C16.7893 247.5 0 230.711 0 210V90C0 69.2893 16.7893 52.5 37.5 52.5ZM37.5 67.5C25.0736 67.5 15 77.5736 15 90V210C15 222.426 25.0736 232.5 37.5 232.5H262.5C274.926 232.5 285 222.426 285 210V90C285 77.5736 274.926 67.5 262.5 67.5H37.5ZM52.5 112.5C48.3579 112.5 45 109.142 45 105C45 100.858 48.3579 97.5 52.5 97.5H67.5C71.6421 97.5 75 100.858 75 105C75 109.142 71.6421 112.5 67.5 112.5H52.5ZM97.5 112.5C93.3579 112.5 90 109.142 90 105C90 100.858 93.3579 97.5 97.5 97.5H112.5C116.642 97.5 120 100.858 120 105C120 109.142 116.642 112.5 112.5 112.5H97.5ZM142.5 112.5C138.358 112.5 135 109.142 135 105C135 100.858 138.358 97.5 142.5 97.5H157.5C161.642 97.5 165 100.858 165 105C165 109.142 161.642 112.5 157.5 112.5H142.5ZM187.5 112.5C183.358 112.5 180 109.142 180 105C180 100.858 183.358 97.5 187.5 97.5H202.5C206.642 97.5 210 100.858 210 105C210 109.142 206.642 112.5 202.5 112.5H187.5ZM232.5 112.5C228.358 112.5 225 109.142 225 105C225 100.858 228.358 97.5 232.5 97.5H247.5C251.642 97.5 255 100.858 255 105C255 109.142 251.642 112.5 247.5 112.5H232.5ZM52.5 157.5C48.3579 157.5 45 154.142 45 150C45 145.858 48.3579 142.5 52.5 142.5H67.5C71.6421 142.5 75 145.858 75 150C75 154.142 71.6421 157.5 67.5 157.5H52.5ZM97.5 157.5C93.3579 157.5 90 154.142 90 150C90 145.858 93.3579 142.5 97.5 142.5H112.5C116.642 142.5 120 145.858 120 150C120 154.142 116.642 157.5 112.5 157.5H97.5ZM142.5 157.5C138.358 157.5 135 154.142 135 150C135 145.858 138.358 142.5 142.5 142.5H157.5C161.642 142.5 165 145.858 165 150C165 154.142 161.642 157.5 157.5 157.5H142.5ZM187.5 157.5C183.358 157.5 180 154.142 180 150C180 145.858 183.358 142.5 187.5 142.5H202.5C206.642 142.5 210 145.858 210 150C210 154.142 206.642 157.5 202.5 157.5H187.5ZM232.5 157.5C228.358 157.5 225 154.142 225 150C225 145.858 228.358 142.5 232.5 142.5H247.5C251.642 142.5 255 145.858 255 150C255 154.142 251.642 157.5 247.5 157.5H232.5ZM52.5 202.5C48.3579 202.5 45 199.142 45 195C45 190.858 48.3579 187.5 52.5 187.5H67.5C71.6421 187.5 75 190.858 75 195C75 199.142 71.6421 202.5 67.5 202.5H52.5ZM97.5 202.5C93.3579 202.5 90 199.142 90 195C90 190.858 93.3579 187.5 97.5 187.5H202.5C206.642 187.5 210 190.858 210 195C210 199.142 206.642 202.5 202.5 202.5H97.5ZM232.5 202.5C228.358 202.5 225 199.142 225 195C225 190.858 228.358 187.5 232.5 187.5H247.5C251.642 187.5 255 190.858 255 195C255 199.142 251.642 202.5 247.5 202.5H232.5Z"
          fill="var(--color-primary)"
        />

        {/* Hidden reference shapes (targets) */}
        <path
          id="discuss"
          d="M27.7723 223.726L17.3754 244.52C15.8133 247.644 15 251.089 15 254.582V270C15 278.284 21.7157 285 30 285H45C53.2843 285 60 278.284 60 270V254.582C60 251.089 59.1867 247.644 57.6246 244.52L47.2277 223.726C44.1254 224.557 40.8644 225 37.5 225C34.1356 225 30.8746 224.557 27.7723 223.726ZM14.3594 217.011C5.61635 210.145 0 199.479 0 187.5C0 166.789 16.7893 150 37.5 150C58.2107 150 75 166.789 75 187.5C75 199.479 69.3837 210.145 60.6406 217.011L71.041 237.812C73.6446 243.019 75 248.76 75 254.582V270C75 286.569 61.5685 300 45 300H30C13.4315 300 0 286.569 0 270V254.582C0 248.76 1.35544 243.019 3.95898 237.812L14.3594 217.011ZM252.772 223.726L242.375 244.52C240.813 247.644 240 251.089 240 254.582V270C240 278.284 246.716 285 255 285H270C278.284 285 285 278.284 285 270V254.582C285 251.089 284.187 247.644 282.625 244.52L272.228 223.726C269.125 224.557 265.864 225 262.5 225C259.136 225 255.875 224.557 252.772 223.726ZM239.359 217.011C230.616 210.145 225 199.479 225 187.5C225 166.789 241.789 150 262.5 150C283.211 150 300 166.789 300 187.5C300 199.479 294.384 210.145 285.641 217.011L296.041 237.812C298.645 243.019 300 248.76 300 254.582V270C300 286.569 286.569 300 270 300H255C238.431 300 225 286.569 225 270V254.582C225 248.76 226.355 243.019 228.959 237.812L239.359 217.011ZM133.57 221.906C133.342 222.22 133.086 222.52 132.803 222.803L111.59 244.017C107.371 248.236 105 253.959 105 259.926V270C105 278.284 111.716 285 120 285H180C188.284 285 195 278.284 195 270V259.926C195 253.959 192.629 248.236 188.41 244.017L167.197 222.803C166.914 222.52 166.658 222.22 166.43 221.906C161.34 223.903 155.798 225 150 225C144.202 225 138.66 223.903 133.57 221.906ZM120.452 213.941C110.984 205.691 105 193.544 105 180C105 155.147 125.147 135 150 135C174.853 135 195 155.147 195 180C195 193.544 189.016 205.691 179.548 213.941L199.017 233.41C206.049 240.443 210 249.981 210 259.926V270C210 286.569 196.569 300 180 300H120C103.431 300 90 286.569 90 270V259.926C90 249.981 93.9509 240.443 100.983 233.41L120.452 213.941ZM150 210C166.569 210 180 196.569 180 180C180 163.431 166.569 150 150 150C133.431 150 120 163.431 120 180C120 196.569 133.431 210 150 210ZM262.5 210C274.926 210 285 199.926 285 187.5C285 175.074 274.926 165 262.5 165C250.074 165 240 175.074 240 187.5C240 199.926 250.074 210 262.5 210ZM37.5 210C49.9264 210 60 199.926 60 187.5C60 175.074 49.9264 165 37.5 165C25.0736 165 15 175.074 15 187.5C15 199.926 25.0736 210 37.5 210ZM155.303 117.803C152.374 120.732 147.626 120.732 144.697 117.803L131.893 105H112.5C91.7893 105 75 88.2107 75 67.5V37.5C75 16.7893 91.7893 0 112.5 0H187.5C208.211 0 225 16.7893 225 37.5V67.5C225 88.2107 208.211 105 187.5 105H168.107L155.303 117.803ZM150 101.893L159.697 92.1967C161.103 90.7902 163.011 90 165 90H187.5C199.926 90 210 79.9264 210 67.5V37.5C210 25.0736 199.926 15 187.5 15H112.5C100.074 15 90 25.0736 90 37.5V67.5C90 79.9264 100.074 90 112.5 90H135C136.989 90 138.897 90.7902 140.303 92.1967L150 101.893Z"
          fill="currentColor"
          opacity="0"
        />
        <path
          id="prototype"
          d="M218.182 68.4V208.198L238.636 228.748L259.091 208.198V68.4H218.182ZM218.182 54.8H259.091V27.8002H218.182V54.8ZM272.727 82V211C272.727 212.795 272.016 214.517 270.748 215.79L243.475 243.191C240.809 245.87 236.464 245.87 233.798 243.191L206.525 215.79C205.257 214.517 204.545 212.795 204.545 211V177.2H197.727C186.431 177.2 177.273 168.067 177.273 156.8V116C177.273 104.733 186.431 95.6 197.727 95.6H204.545V82H68.1818V184C68.1818 187.756 65.1292 190.8 61.3636 190.8H54.5455C31.952 190.8 13.6364 209.067 13.6364 231.6C13.6364 254.133 31.952 272.4 54.5455 272.4H286.364V82H272.727ZM272.727 68.4H293.182C296.947 68.4 300 71.4445 300 75.2V279.2C300 282.956 296.947 286 293.182 286H54.5455C24.4208 286 0 261.644 0 231.6V75.2C0 41.4002 27.4734 14 61.3636 14C65.1292 14 68.1818 17.0445 68.1818 20.8V68.4H204.545V21.0002C204.545 17.2446 207.598 14.2002 211.364 14.2002H265.909C269.675 14.2002 272.727 17.2446 272.727 21.0002V68.4ZM204.545 109.2H197.727C193.962 109.2 190.909 112.244 190.909 116V156.8C190.909 160.556 193.962 163.6 197.727 163.6H204.545V109.2ZM13.6364 195.617C23.6311 184.323 38.2542 177.2 54.5455 177.2V28.082C31.4162 31.3816 13.6364 51.22 13.6364 75.2V195.617ZM102.273 95.6H143.182C154.479 95.6 163.636 104.733 163.636 116V156.8C163.636 168.067 154.479 177.2 143.182 177.2H102.273C90.976 177.2 81.8182 168.067 81.8182 156.8V116C81.8182 104.733 90.976 95.6 102.273 95.6ZM102.273 109.2C98.5072 109.2 95.4545 112.244 95.4545 116V156.8C95.4545 160.556 98.5072 163.6 102.273 163.6H143.182C146.947 163.6 150 160.556 150 156.8V116C150 112.244 146.947 109.2 143.182 109.2H102.273ZM88.6364 218C84.8708 218 81.8182 214.956 81.8182 211.2C81.8182 207.444 84.8708 204.4 88.6364 204.4H184.091C187.856 204.4 190.909 207.444 190.909 211.2C190.909 214.956 187.856 218 184.091 218H88.6364ZM88.6364 245.2C84.8708 245.2 81.8182 242.156 81.8182 238.4C81.8182 234.644 84.8708 231.6 88.6364 231.6H197.727C201.493 231.6 204.545 234.644 204.545 238.4C204.545 242.156 201.493 245.2 197.727 245.2H88.6364Z"
          fill="currentColor"
          opacity="0"
        />
        <path
          id="product"
          d="M45 105V150H105V105H45ZM15 60H225V37.5C225 25.0736 214.926 15 202.5 15H37.5C25.0736 15 15 25.0736 15 37.5V60ZM172.497 75H15V217.5C15 229.926 25.0736 240 37.5 240H165V225H142.5C138.358 225 135 221.642 135 217.5C135 213.358 138.358 210 142.5 210H165V195H142.5C138.358 195 135 191.642 135 187.5C135 183.358 138.358 180 142.5 180H165V165H142.5C138.358 165 135 161.642 135 157.5V97.5C135 93.3579 138.358 90 142.5 90H165.75C166.875 84.4584 169.222 79.3606 172.497 75ZM240 60H262.5C283.211 60 300 76.7893 300 97.5V262.5C300 283.211 283.211 300 262.5 300H202.5C181.789 300 165 283.211 165 262.5V255H37.5C16.7893 255 0 238.211 0 217.5V37.5C0 16.7893 16.7893 0 37.5 0H202.5C223.211 0 240 16.7893 240 37.5V60ZM165 150V105H150V150H165ZM37.5 90H112.5C116.642 90 120 93.3579 120 97.5V157.5C120 161.642 116.642 165 112.5 165H37.5C33.3579 165 30 161.642 30 157.5V97.5C30 93.3579 33.3579 90 37.5 90ZM180 97.5V262.5C180 274.926 190.074 285 202.5 285H262.5C274.926 285 285 274.926 285 262.5V97.5C285 85.0736 274.926 75 262.5 75H202.5C190.074 75 180 85.0736 180 97.5ZM37.5 195C33.3579 195 30 191.642 30 187.5C30 183.358 33.3579 180 37.5 180H112.5C116.642 180 120 183.358 120 187.5C120 191.642 116.642 195 112.5 195H37.5ZM37.5 225C33.3579 225 30 221.642 30 217.5C30 213.358 33.3579 210 37.5 210H82.5C86.6421 210 90 213.358 90 217.5C90 221.642 86.6421 225 82.5 225H37.5ZM202.5 105H262.5C266.642 105 270 108.358 270 112.5V142.5C270 146.642 266.642 150 262.5 150H202.5C198.358 150 195 146.642 195 142.5V112.5C195 108.358 198.358 105 202.5 105ZM210 120V135H255V120H210ZM202.5 180C198.358 180 195 176.642 195 172.5C195 168.358 198.358 165 202.5 165H262.5C266.642 165 270 168.358 270 172.5C270 176.642 266.642 180 262.5 180H202.5ZM202.5 210C198.358 210 195 206.642 195 202.5C195 198.358 198.358 195 202.5 195H247.5C251.642 195 255 198.358 255 202.5C255 206.642 251.642 210 247.5 210H202.5ZM30 30H45V45H30V30ZM60 30H75V45H60V30ZM90 30H105V45H90V30ZM217.5 270C213.358 270 210 266.642 210 262.5C210 258.358 213.358 255 217.5 255H247.5C251.642 255 255 258.358 255 262.5C255 266.642 251.642 270 247.5 270H217.5Z"
          fill="currentColor"
          opacity="0"
        />
      </svg>
    </div>
  );
}
